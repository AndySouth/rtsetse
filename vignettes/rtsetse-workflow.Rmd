---
title: "rtsetse workflow"
author: "Andy South"
date: "`r Sys.Date()`"
#output: rmarkdown::html_vignette
#to produce a pdf
output: rmarkdown::pdf_document
vignette: >
  %\VignetteIndexEntry{rtsetse workflow}
  %\VignetteEngine{knitr::rmarkdown}
  \usepackage[utf8]{inputenc}
---
  

```{r global_options, include=FALSE}
#to try to stop figs being moved too much
#didn't seem to make any difference !
#possibly because it's non R figures I'm trying to position
#perhaps I can set an option in the markdown figure call ?
#http://stackoverflow.com/questions/29696172/how-to-hold-figure-position-with-figure-caption-in-pdf-output-of-knitr
knitr::opts_chunk$set(fig.pos = 'H')
```  
  
[rtsetse](https://github.com/AndySouth/rtsetse) is an R package for simulating tsetse fly populations to investigate control options. It follows from [Hat-Trick](http://www.tsetse.org), an Excel Tsetse model.

This document outlines how rtsetse can be used. All text in the grey boxes below can be copied and pasted into the R console (including a simple command to start up a user interface for the model : `rt_UI()`). 

### Installation from R

```{r, eval=FALSE, echo=TRUE, message=FALSE}
require(devtools)    
install_github('AndySouth/rtsetse', build_vignettes=TRUE)  
```
    
### How to run the model, first examples    

```{r, eval=FALSE, echo=TRUE, message=FALSE}
# Load the package in each new R session.
library(rtsetse)
```

### Where to find documentation  

```{r, eval=FALSE, echo=TRUE, message=FALSE}
# This will bring up a brief description of the rtsetse package :
?rtsetse

# Click on 'index' at the bottom of the description page to go to a list of help pages 
# for each function in the package.

```
    
### User Interface
```{r, eval=FALSE, echo=TRUE, message=FALSE}

# to start a graphical user interface 
# with options and buttons allowing the model to be run and outputs to be viewed
rt_UI()
```

The user interface starts with an 'About' screen (Fig. 1) followed by 5 others.

![Start page of rtsetse UI reached by `rt_UI()`](rtsetseUI_about.png) 


1. seek stable mortality 
    + select population parameters to find adult mortality values that generate stability and will be used in later screens
    + can be skipped to accept default inputs
2. aspatial model
    + runs model for a single randomly-mixed population using inputs from 1.
3. load map
    + load a map from the package or elsewhere to be used in 4.
4. run grid model
    + run a gridded model using inputs from 1, 2 & 3.
5. control
    + add simple control options to inputs from 1,2,3, & 4


##### UI 1. seek stable mortality
Modify population inputs on the left hand side (Fig. 2), then press the 'Seek Stable Mortality' button at the top. View results on the right hand side, e.g. for mortality by age (Fig. 3).

##### UI 2. aspatial model
Modify inputs on the left hand side (Fig. 4), press the 'Run Model' button. View results on the right hand side, e.g. 'Males by age' to see the number of males in each age class in each day. The 'Code' tab contains code that can be copied and pasted into the R console to recreate this run.    

##### UI 3. load map


\pagebreak

### Command Line running

`rtsetse` functions can be run from the R command line giving the user more control.

```{r, eval=FALSE, echo=TRUE, message=FALSE}
# (Not evaluated here because takes a minute or so to run)

# To find documentation about this function and the inputs.
?rt_runGrid

# Set number of days.
iDays <- 10
# Run the model (results are saved to aRecord or any othr object name you choose to use).
aRecord <- 
  rt_runGrid (  pMoveF=0.6,  pMoveM=0.3,   iDays=iDays,  pMortF=0.082,  pMortM=0.139,  
                pMortPupa=0.2,  fStartPopPropCC=1,  iCarryCapF=200,  propMortAdultDD=0.25,  
                iFirstLarva=16,  iInterLarva=10,  pMortLarva=0.05,  propMortLarvaDD=0.25,  
                propMortPupaDD=0.25,  
                mVegCats=system.file("extdata","vegHalfSavannahHalfGrass50x50.txt", 
                                     package="rtsetse"),
                dfMortByVeg=list(code = c("D", "T", "O", "S", "B", "G", "N"), 
                                 name = c("Dense Forest", "Thicket", "Open Forest", 
                                          "Savannah", "Bush", "Grass", "No-go area"), 
                                 mortality = c(200, 150, 110, 100, 110, 210, 999), 
                                 pupmortality = c(120, 110, 105, 100, 120, 170, 999))  )

# Plot some of model results (in this case adult popn across the whole grid).
rtPlotPopGrid(aRecord)
# or plot a map of the population distribution
rtPlotMapPop(aRecord)
# or select particular days, ages and genders
rtPlotMapPop(aRecord, days='final', sex = 'M', age = (20:120))

```


![UI screen 1: seek stable mortality](rtsetseUI_1seek.png)

![UI screen 1: seek stable mortality, output by age](rtsetseUI_1seek mort_by_age)

![UI screen 2: aspatial model](rtsetseUI_2aspatial.png)

![UI screen 3: load map starting example](rtsetseUI_3map_start.png)

![UI screen 3: load map : one of the stored maps](rtsetseUI_3map_stored.png)



